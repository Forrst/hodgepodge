import MySQLdb
import numpy as np
import pandas as pd
df = pd.read_csv("E:\\git\\rfm.csv")
rfm = df[['r','f','m']]
rfm_matrix = rfm.values
from sklearn.cluster import KMeans
kmeans=KMeans(n_clusters=8)
kmeans.fit(rfm_matrix)
rfm_level = kmeans.labels_

account = '''68017108
68008208
67086168
66022628
67058128
67057598
10301030
67011258
29688888
65086778
65009078
62096618
66082178
66081908
66078528
66076228
66029968
66029718
66025258
66020758
66017808
66010168
66010508
66017698
66009968
55528888
65057768
63098098
63099588
63079908
63079628
60019128
60018608
60016538
60016708
69857908
69849378
61840308
60828798
60829358
61862008
61864308
69808808
60801388
61896978
66009598
66010118
61899158
61899408
60828208
60851508
62010138
61851988
65021228
60006288
61849618
66029218
61855408
60009808
61830768
67026928
61881208
60848668
62006138
63067298
69820778
66070088
66010908
66010278
60809908
67814898
61821798
60012758
66012238
11380223
67070808
60844988
62095018
62081718
62096218
65012168
69846008
62058968
61883688
61832298
63069038
61855488
65027608
61828808
60828288
60805158
69816878
62087578
60825878
61885728
66009868
69893338
66017118
69856008
60817718
69847508
61855698
61879858
61885898
68842428
69857918
61866868
61884488
67011188
69823118
60820858
60807928
60808358
66012268
60012058
65006088
61899828
68899628
66009958
69802318
65075628
60886418
61859998
61899678
66069578
69897578
66016978
66017668
61879498
69827708
61880698
69851088
61898978
61887518
61878278
65022708
69827128
61886818
69821998
69887978
60827168
60817208
61884768
66025108
62096708
69829618
61803628
61883478
61887668
63025178
61865178
66852618
60808018
66017708
66022208
61845828
62844968
61885078
60825018
61885178
69888598
69826058
61896808
66010518
61825328
69810508
60800768
63000028
60820428
66011278
69812218
61869258
61828778
61828078
61852508
69897868
61896598
61842818
61888298
61896798
61895758
61855568
60824618
62086888
61854788
61878408
67050578
61882498
61894088
69873098
61859378
69897278
60019238
65008768
61871208
69852968
69868878
61847358
61895398
68839568
66051708
60821998
60005698
62887268
63089698
61803258
60016058
66012198
68844268
61895018
69827068
69891818
61853518
66010678
61872728
62057788
63018238
60803098
61897368
61893498
65075768
65627732
61842858
63076178
61828528
61827318
62091138
66011508
69887898
60806678
69824188
61897758
66016968
65018738
65017818
66099668
60828778
61830378
66061988
63087978
66009818
61843168
66010808
66011598
61875728
68848298
68844728
61844378
61858468
61846328
61898528
62019628
61885478
61830908
60801888
69842698
69853898
61862708
60800668
62076108
60813298
63000598
69897028
61895708
65011628
61814628
60800558
61852798
69833758
67811678
60055038
69825208
60800808
62019118
66021618
61894898
65011858
69871208
61892428
61884518
62067138
66029168
68848108
60803298
66009928
61858968
61824598
65011678
63082758
67856898
61887328
61848078
68840558
60800478
66010188
61802998
61802758
69824488
60800128
63015118
61861318
69819878
65027028
60818558
61885618
63071208
63072518
69852808
61844578
61855478
66022268
69817858
66019018
61870058
66011518
66010588
61868778
60827668
61827478
61880928
69835968
66010898
60819458
61890028
60802358
63058168
61891368
61868688
66018698
61872418
60819368
61842558
62061058
61871418
66892818
60801318
61872108
66097198
66027598
60821228
61802108
63088718
69856598
63078188
61826008
60823578
61820798
60800218
61892178
66011238
65028598
60016828
62077638
65025718
69815778
61889318
63098628
61830788
60804968
65072808
69824508
69854598
67855118
69829388
61827828
66090628
63081778
61839928
61873788
69891168
69870518
69885868
63001078
69829018
61888068
69854458
66011528
69864058
66018938
69866198
61854108
69890368
69819608
61875928
60002128
66010218
61848828
60826078
61887788
69851778
66021828
61827788
66010778
69868888
66011028
69892998
61827898
65026918
62072598
60804298
63081928
69884688
61842718
63091968
61865828
61824218
63062598
69838378
60820058
61841768
61857198
62077038
61874908
61801168
60831008
63088888
69890828
61872298
62070088
69877288
66076118
65020618
66018658
69842208
69892708
60806928
60803788
66017958
60817668
61895858
62017968
61893418
69893078
62058938
61807398
60815988
60808508
66021968
69837368
60812768
61884598
62075088
60825398
65088778
61864968
61893578
60878288
66016988
66016758
61843478
69880318
66019978
61847758
65022598
61849228
61874618
61887888
69883788
66017628
61860198
63079168
66076508
60817768
61857408
63025618
61897328
66010888
61887218
65061038
61890728
66010758
69809128
66010968
61853298
61845088
61894928
61849878
61894858
61848608
61852868
67810758
62021958
61890298
61875758
65010118
61878088
66068018
61890608
63000838
60816108
61822808
66010788
69887098
63071858
65005218
69819188
61828218
65005768
63089218
60018718
69883588
66051678
61839908
66832129
61898068
61848218
61871668
61803188
60884558
61869608
65056518
65026288
66011298
61827298
68844668
68840888
62098578
61826318
65076898
66010958
69840588
63090738
69849198
61854118
61831218
66027108
69821458
66092058
60884998
61847708
60801298
61829188
63055138
60088128
66010128
63027128
63022138
60015738
61850808
66893728
69897738
69898028
61883168
61888918
60818178
61843788
60801278
67816698
61822498
61888258
61833258
65088818
66028128
61824698
60831068
66856658
65894998
62099078
61856118
61880398
61850078
61833598
61830058
61894798
66010998
69810588
61867408
61820788
67814278
61849568
61857608
61820898
61885328
65894618
60816178
61865908
61842488
65008018
60829488
61832008
61869158
61862418
61808178
61890188
69834458
65076058
61879768
61867188
61898808
61843008
63021788
61821108
60815578
63061768
61840168
61827408
61879188
61891708
61869458
67854028
69837398
60807318
61819718
67854088
66050538
61875328
62082838
63089008
67011098
69865328
60823598
65028718
69853968
60822988
63012278
61879288
67817628
65011138
62000858
60005098
61852758
60822368
62016638
63070228
60801368
66099018
61883598
61836218
65052618
67855288
61867698
60806198
67020078
68839268
61833028
69854568
60822998
63065128
61806828
61825758
69801078
61885098
65895088
61895128
61845298
61899788
62028278
63091028
68841708
61860378
61844968
60814878
61893818
61887128
65055628
61893318
61887718
61826078
63026028
69876868
62005668
61890588
60824798
60824568
69886068
60821468
69815228
63012728
66009528
61846298
65052758
63089258
67019908
60800468
65007958
65022288
61840488
68839218
63022958
66017138
65019108
62072638
69831568
61846978
61827358
63080938
61842408
62082698
66069628
63055658
69828018
60813978
61882998
61895168
66076678
61894618
60820878
65052688
61807888
61851798
61895458
62055638
67813058
61841328
66018958
60821488
61899088
60812808
61828698
68843278
61881768
61827798
61850718
61849678
61884108
63086238
61858978
61828118
62006868
61850698
66009918
69886858
68899708
62005168
61845468
66011078
61801678
61852318
61889998
66082508
61858688
61827288
61855388
60829128
69855208
69856728
61846678
69829368
63000278
66018978
61886958
69834158
61835688
60802858
65008128
61873368
69827378
60822228
61886978
66020028
62095188
61807868
66019008
69829958
65089728
60081298
61807658
69878708
61835268
60805608
66011098
61850358
61847588
61852328
61827118
67810078
61826668
69813528
65027058
60822768
61882558
61811188
61844018
69868728
62082768
62071678
61827308
61864298
61848928
68840908
67809808
63059588
61874628
62096258
61861698
63071838
63066768
69888618
61828578
69819468
61865918
60826178
61899428
62092128
62097078
61864268
69881118
61891098
60814168
61885268
61885278
61869488
66893878
61825398
61842128
69885658
60830798
61897718
61893858
61893358
61842568
60831208
65089758
66018628
62096298
66051898
69832178
60015708
69868268
61853388
63062538
69890378
60823918
66010098
61847808
61850098
66010108
68844488
63058128
60806188
61858778
61884788
68839828
60822098
61829488
61876808
63060508
63050178
60807908
61845288
60813528
61826878
61880578
61805658
61826178
61873228
61835698
61854268
60817128
65012608
65025608
60086128
67067028
60821958
61850088
69848158
69840168
65051718
66011658
61811158
69877008
61888718
66018988
61807298
66052608
65025988
66017678
65051888
62090898
60803908
69816128
61851378
61871968
61880218
62060998
60000008
61812268
67052688
65011008
61811918
61821168
66017088
69863678
66010268
61859208
60831358
62079118
62092188
61845488
66016998
66019178
66882078
67854498
65009988
69877908
62020658
61854758
69875668
65007018
61894608
66052218
61853868
62090758
63067608
67819058
61885568
61830308
66010158
63022168
69885518
61803158
63099028
66892978
69826728
61867518
60824808
68848418
65002528
63002178
61870008
61842108
69835128
61840618
60806988
61870708
61833828
63012898
66018838
62086578
66019238
61825978
69836488
63068788
65019208
69870168
60016568
61854428
66077598
67851688
67809158
69859998
61844908
66026908
61887578
61851658
62095858
62085608
66009978
61855058
60803968
60806578
62099878
63020258
62086228
61847278
61832408
61846668
60806798
69876678
66081188
69833168
62097208
69864068
66029568
65026738
60828628
60807688
61848578
69826028
63071098
68842528
63067038
61823198
66017108
62086718
66050038
69883368
66021638
66062238
67016628
60804598
61893768
60829578
61818999
61834288
63060808
66075238
63077688
61835878
69831828
61882378
66091838
63058988
69870568
60818788
65005928
68844958
69878128
67011918
61832188
63001288
69865158
61841998
69866628
61855658
69838298
69852278
61864998
66010918
61890228
66076238
61877668
61861558
69810118
60805678
62090228
61895428
60801818
62098938
60806058
62091518
62091888
69876588
69817028
61847668
61889108
67822628
67050988
61881358
61895078
65892198
68841978
63097298
61840198
66011038
60823258
61873878
60804818
69851728
61860078
61823428
69886078
61887918
66010668
66080228
61834598
60001188
60801688
61891278
61851788
60009158
61855978
61824418
69868188
65029928
61841418
69849618
69866108
62087078
69856118
61803198
61872708
60085758
61824468
61853458
62097718
61828458
65007978
69896628
69830908
61895178
66028828
69885088
61847468
67077008
61835588
61868658
65895728
63068598
66080878
60826888
63057278
69887988
61847408
66010568
63065288
61843088
65020088
61866928
69836768
69884068
63065628
61889258
61882978
66096818
65008918
69871528
60808168
69885588
66075278
69889218
62098098
65021068
63060288
69885758
61827488
69892658
62090618
69820808
60089918
61894408
67005828
61898708
67818528
61878768
62066188
60805908
61845278
61815628
61820218
62087198
61894118
62075278
67853678
63015098
63085728
60010588
66028958
62082278
60815828
69838798
61870768
65052788
65008538
69884228
61853798
60821528
69849168
61834688
63099538
60829158
62085698
69898278
63097268
62079178
62087758
66029918
60805068
61844658
61879778
63020898
69823728
69897898
60829508
69869728
63022588
61853178
62020738
62080988
60002168
66068808
67095618
60800618
61840588
60806508
69895628
60016038
60822828
67000278
66091808
61827928
69834478
62090518
63067868
60810458
69883408
69864318
69885228
62085208
63075028
63087758
61886518
63002658
61855898
69856388
61829928
61835598
61804188
61821968
61835898
61894998
65008168
60828718
63012808
61851678
61841578
63022578
65085058
60827898
69882708
69825328
69866918
67005088
68843808
61840178
69840598
61899728
67854128
62091878
61820658
65892278
61856208
67822328
63098538
61830328
67021738
65002278
60018258
60813208
69880258
60018568
69876288
68844828
69848008
66017038
69847108
66076018
61871428
69835928
63066278
69828758
68842358
69899598
69855118
61816908
61826898
61843388
61826378
63067668
61854058
61807788
67856308
66077988
69867958
65897408
61882028
60848278
63011728
68845018
61853408
61813488
60018638
65008668
63097078
66894308
68841968
69836528
69878208
63022598
69841698
68845398
61869288
63099528
68843188
61891318
63066978
61864258
69885488
61864278
65011098
69871508
60823678
62095158
69885528
67021868
62008838
63022678
65892488
65025038
61858308
60823088
65018868
63025078
69862208
66062618
60827188
61891328
67070138
69823068
60818528
62090528
66090828
69885958
68840778
60812298
63059128
61818023
61868808
67817008
63010228
61822718
61861858
62099188
66092618
61895728
62090838
61860288
62087978
62086938
60824888
61824208
61810768
61888118
66071088
66090638
63009518
69850988
65027068
63060518
62090968
69877558
61823628
61831328
69839708
66667878
60812788
60818888
65007198
62018268
66019188
62092208
66070658
61860278
63085598
61874588
60806268
61895088
60851828
62092158
62098508
69889788
65001588
67843398
61802098
60812128
61820368
69891558
61801818
69827368
68841458
62086768
69867908
61832168
67851418
60018678
61858608
61871398
65052918
67068288
69877058
68848478
62058658
69887688
67000978
61844228
66081628
62092518
62086588
69896008
61814708
69891028
68839618
66097898
60800578
69830918
65021208
67001678
69887778
68844388
69830458
60814078
69889608
61868858
62071768
62068138
65008798
66052288
67001028
62061188
61856508
66050758
61832128
61855998
61882908
61858028
61831298
69856198
69821488
65962866
69815908
61859258
69884168
60829828
66020578
67016678
67620647
63095108
61835188
62088868
61811078
67055638
62080228
60823458
66072158
60018288
61876528
60815628
61807288
61867658
60824488
67055028
61860788
60817958
61897508
67844998
61840958
61883908
61873698
63021968
66893708
69891718
69886898
65015998
61812628
62091678
67812008
61807058
66689888
69819228
69868478
69810608
63082078
67000738
67853368
63018988
60818998
69893333
61834678
63095668
62099568
61851028
60803388
62096938
60822758
19890807
62080078
65017298
67812398
61834528
61884418
65059038
62087538
63098778
61885908
66025268
61891078
62077218
65008888
61858488
68845178
61843608
60807788
67005598
61857998
61858598
67017228
65089058
60826558'''
accounts = account.split("\n")
net_assets_sql = f'''
                    SELECT
                    a.account_id,
                    sum(
                    a.net_assets * b.exchange_rate
                    ) AS total_net_assets,
                    sum(a.market_value*b.exchange_rate) as total_market_value
                    FROM
                    (
                    SELECT
                    account_id,
                        market_value + trade_balance + ipo_frozen_before_close AS net_assets,
                        market_value,
                        currency,
                        process_date
                    FROM
                        account_balance
                    WHERE
                        account_id in {str(accounts).replace("[","(").replace("]",")")}
                    AND process_date = '2020-02-25'
                    ) a
                    LEFT JOIN (
                    SELECT
                    process_date,
                    currency,
                    exchange_rate
                    FROM
                    currency_history
                    WHERE
                    process_date = '2020-02-25'
                    ) b ON a.process_date = b.process_date
                    AND a.currency = b.currency
                    group by account_id
                '''
con = MySQLdb.connect(host="192.168.5.105", user="root", passwd="zunjiazichan123", db="jcbms", charset="utf8")
data = pd.read_sql(net_assets_sql,con)